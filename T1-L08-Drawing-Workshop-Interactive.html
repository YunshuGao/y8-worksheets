<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Drawing Workshop — From Container to Countertop</title>
  <style>
    :root {
      --primary: #3b82f6;
      --primary-dark: #2563eb;
      --primary-light: #dbeafe;
      --accent: #f97316;
      --accent-dark: #ea580c;
      --accent-light: #fff7ed;
      --success: #22c55e;
      --success-light: #dcfce7;
      --error: #ef4444;
      --error-light: #fee2e2;
      --warning: #eab308;
      --bg: #f1f5f9;
      --card: #ffffff;
      --border: #e2e8f0;
      --text: #0f172a;
      --text-muted: #64748b;
      --text-light: #94a3b8;
      --radius: 12px;
      --shadow: 0 1px 3px rgba(0,0,0,0.1), 0 1px 2px rgba(0,0,0,0.06);
      --shadow-lg: 0 4px 6px rgba(0,0,0,0.1), 0 2px 4px rgba(0,0,0,0.06);
    }

    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      font-family: system-ui, -apple-system, 'Segoe UI', sans-serif;
      background: var(--bg);
      color: var(--text);
      line-height: 1.6;
      min-height: 100vh;
    }

    /* HEADER */
    .header {
      background: linear-gradient(135deg, var(--primary), var(--primary-dark));
      color: white;
      padding: 1.25rem 2rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
      gap: 0.5rem;
    }
    .header-left h1 { font-size: 1.5rem; font-weight: 700; letter-spacing: -0.025em; }
    .header-left p { font-size: 0.875rem; opacity: 0.9; }
    .header-right { display: flex; gap: 0.5rem; flex-wrap: wrap; align-items: center; }
    .header-badge {
      background: rgba(255,255,255,0.2);
      padding: 0.25rem 0.75rem;
      border-radius: 20px;
      font-size: 0.8rem;
      font-weight: 500;
    }
    .header-input {
      padding: 0.35rem 0.75rem;
      border: 2px solid rgba(255,255,255,0.4);
      border-radius: 8px;
      background: rgba(255,255,255,0.15);
      color: white;
      font-size: 0.85rem;
      outline: none;
      width: 140px;
    }
    .header-input::placeholder { color: rgba(255,255,255,0.6); }
    .header-input:focus { border-color: white; background: rgba(255,255,255,0.25); }

    /* LEVEL BAR */
    .level-bar {
      display: flex;
      justify-content: center;
      gap: 0.5rem;
      padding: 0.5rem 1rem;
      background: var(--card);
      border-bottom: 1px solid var(--border);
    }
    .level-btn {
      padding: 0.35rem 1rem;
      border: 2px solid var(--border);
      background: var(--card);
      border-radius: 20px;
      cursor: pointer;
      font-size: 0.8rem;
      font-weight: 500;
      transition: all 0.2s;
    }
    .level-btn:hover { border-color: var(--primary); color: var(--primary); }
    .level-btn.active { background: var(--primary); color: white; border-color: var(--primary); }

    /* SECTION NAV */
    .section-nav {
      display: flex;
      background: var(--card);
      border-bottom: 2px solid var(--border);
      position: sticky;
      top: 0;
      z-index: 100;
      overflow-x: auto;
    }
    .section-btn {
      flex: 1;
      min-width: 140px;
      padding: 0.9rem 1rem;
      border: none;
      background: none;
      cursor: pointer;
      font-size: 0.85rem;
      font-weight: 500;
      color: var(--text-muted);
      border-bottom: 3px solid transparent;
      transition: all 0.2s;
      text-align: center;
    }
    .section-btn.active {
      color: var(--primary);
      border-bottom-color: var(--primary);
      font-weight: 600;
      background: var(--primary-light);
    }
    .section-btn:hover { color: var(--primary); }
    .section-btn .step-count {
      display: block;
      font-size: 0.7rem;
      color: var(--text-light);
      margin-top: 2px;
    }
    .section-btn.completed .step-count { color: var(--success); }

    /* CONTENT */
    .section-content {
      display: none;
      max-width: 960px;
      margin: 0 auto;
      padding: 1.5rem;
      animation: fadeIn 0.3s ease;
    }
    .section-content.active { display: block; }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(8px); }
      to { opacity: 1; transform: translateY(0); }
    }

    /* CARDS */
    .card {
      background: var(--card);
      border-radius: var(--radius);
      padding: 1.5rem;
      box-shadow: var(--shadow);
      margin-bottom: 1.25rem;
    }
    .card h2 {
      font-size: 1.15rem;
      margin-bottom: 0.75rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }
    .card h3 { font-size: 1rem; margin-bottom: 0.5rem; }
    .card p { color: var(--text-muted); margin-bottom: 0.75rem; }

    .callout {
      border-left: 4px solid var(--primary);
      background: var(--primary-light);
      padding: 1rem 1.25rem;
      border-radius: 0 var(--radius) var(--radius) 0;
      margin: 1rem 0;
      font-size: 0.95rem;
    }
    .callout strong { color: var(--primary-dark); }
    .callout.accent { border-left-color: var(--accent); background: var(--accent-light); }
    .callout.accent strong { color: var(--accent-dark); }
    .callout.success { border-left-color: var(--success); background: var(--success-light); }
    .callout.success strong { color: #166534; }
    .callout.warning { border-left-color: var(--warning); background: #fefce8; }
    .callout.warning strong { color: #854d0e; }

    /* DRAWING WORKSPACE */
    .workspace {
      display: flex;
      gap: 1.5rem;
      align-items: flex-start;
      flex-wrap: wrap;
    }
    .canvas-area {
      flex: 2;
      min-width: 360px;
    }
    .instruction-area {
      flex: 1;
      min-width: 260px;
    }
    .drawing-canvas {
      width: 100%;
      background: white;
      border: 2px solid var(--border);
      border-radius: var(--radius);
      overflow: hidden;
    }
    .drawing-canvas svg {
      width: 100%;
      display: block;
    }

    /* INSTRUCTION STEPS */
    .step-card {
      background: var(--card);
      border: 2px solid var(--border);
      border-radius: var(--radius);
      margin-bottom: 0.75rem;
      overflow: hidden;
      transition: all 0.3s;
    }
    .step-card.current {
      border-color: var(--primary);
      box-shadow: 0 0 0 3px var(--primary-light);
    }
    .step-card.completed {
      border-color: var(--success);
      background: var(--success-light);
    }
    .step-card.locked {
      opacity: 0.5;
    }
    .step-header {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      padding: 0.75rem 1rem;
      cursor: pointer;
    }
    .step-num {
      width: 28px; height: 28px;
      border-radius: 50%;
      background: var(--border);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.8rem;
      font-weight: 700;
      color: var(--text-muted);
      flex-shrink: 0;
    }
    .step-card.current .step-num { background: var(--primary); color: white; }
    .step-card.completed .step-num { background: var(--success); color: white; }
    .step-title { font-weight: 600; font-size: 0.9rem; }
    .step-body {
      display: none;
      padding: 0 1rem 1rem 1rem;
    }
    .step-card.current .step-body { display: block; }
    .step-card.completed .step-body { display: none; }
    .step-body p { font-size: 0.9rem; margin-bottom: 0.5rem; color: var(--text); }
    .step-measure {
      display: inline-block;
      background: var(--accent);
      color: white;
      padding: 0.15rem 0.5rem;
      border-radius: 4px;
      font-size: 0.8rem;
      font-weight: 600;
      margin: 0.2rem 0;
    }

    /* Done button */
    .done-btn {
      display: inline-flex;
      align-items: center;
      gap: 0.4rem;
      padding: 0.5rem 1.2rem;
      background: var(--success);
      color: white;
      border: none;
      border-radius: 8px;
      font-size: 0.85rem;
      font-weight: 600;
      cursor: pointer;
      margin-top: 0.5rem;
      transition: all 0.2s;
    }
    .done-btn:hover { background: #16a34a; transform: translateY(-1px); }

    /* Show me button for guided mode */
    .showme-btn {
      display: none;
      padding: 0.4rem 0.8rem;
      background: var(--primary-light);
      color: var(--primary-dark);
      border: 2px solid var(--primary);
      border-radius: 6px;
      font-size: 0.8rem;
      font-weight: 500;
      cursor: pointer;
      margin-top: 0.5rem;
      margin-right: 0.5rem;
    }
    .guided .showme-btn { display: inline-block; }

    /* MISTAKES PANEL */
    .mistakes-panel {
      background: var(--error-light);
      border: 2px solid var(--error);
      border-radius: var(--radius);
      padding: 1rem;
      margin-top: 1rem;
    }
    .mistakes-panel h3 { color: #991b1b; margin-bottom: 0.5rem; font-size: 0.95rem; }
    .mistake-row {
      display: flex;
      gap: 1rem;
      align-items: center;
      margin-bottom: 0.75rem;
    }
    .mistake-example {
      flex: 1;
      text-align: center;
      padding: 0.5rem;
      border-radius: 8px;
    }
    .mistake-example.bad { background: #fecaca; }
    .mistake-example.good { background: #bbf7d0; }
    .mistake-example p { font-size: 0.75rem; font-weight: 600; margin-top: 0.25rem; }

    /* PROGRESS BAR */
    .progress-bar-wrap {
      background: var(--border);
      border-radius: 20px;
      height: 10px;
      margin: 0.75rem 0;
      overflow: hidden;
    }
    .progress-bar {
      height: 100%;
      background: linear-gradient(90deg, var(--primary), var(--accent));
      border-radius: 20px;
      transition: width 0.5s ease;
    }

    /* CHECKLIST */
    .checklist {
      list-style: none;
      padding: 0;
    }
    .checklist li {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.5rem 0;
      border-bottom: 1px solid var(--border);
      font-size: 0.9rem;
    }
    .checklist li:last-child { border-bottom: none; }
    .check-icon {
      width: 22px; height: 22px;
      border-radius: 50%;
      border: 2px solid var(--border);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.7rem;
      flex-shrink: 0;
      cursor: pointer;
      transition: all 0.2s;
    }
    .check-icon.checked {
      background: var(--success);
      border-color: var(--success);
      color: white;
    }

    /* BUTTONS */
    .btn {
      padding: 0.6rem 1.25rem;
      border: none;
      border-radius: 8px;
      font-size: 0.9rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
    }
    .btn-primary { background: var(--primary); color: white; }
    .btn-primary:hover { background: var(--primary-dark); }
    .btn-accent { background: var(--accent); color: white; }
    .btn-accent:hover { background: var(--accent-dark); }
    .btn-success { background: var(--success); color: white; }
    .btn-outline { background: white; border: 2px solid var(--border); }
    .btn-outline:hover { border-color: var(--primary); color: var(--primary); }
    .text-center { text-align: center; }
    .mt-1 { margin-top: 0.5rem; }
    .mt-2 { margin-top: 1rem; }

    /* Toolkit card */
    .toolkit {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
      gap: 0.75rem;
      margin-top: 1rem;
    }
    .toolkit-item {
      padding: 0.75rem;
      border-radius: 8px;
      border: 2px solid var(--border);
      display: flex;
      align-items: center;
      gap: 0.5rem;
      font-size: 0.85rem;
    }
    .toolkit-item.done { border-color: var(--success); background: var(--success-light); }
    .toolkit-item.current { border-color: var(--accent); background: var(--accent-light); }
    .toolkit-item.upcoming { opacity: 0.6; }
    .toolkit-icon { font-size: 1.2rem; }

    /* Save */
    .save-area {
      background: var(--success-light);
      border: 2px solid var(--success);
      border-radius: var(--radius);
      padding: 1.25rem;
      text-align: center;
      margin-top: 1.5rem;
    }
    .save-link {
      display: none;
      margin-top: 0.75rem;
      padding: 0.5rem;
      background: white;
      border: 1px solid var(--border);
      border-radius: 6px;
      font-family: monospace;
      font-size: 0.8rem;
      width: 100%;
      word-break: break-all;
    }
    .save-link.show { display: block; }

    /* SVG drawing styles */
    .ghost-line { stroke-dasharray: 6,4; opacity: 0.4; }
    .solid-line { opacity: 1; }
    .highlight-line { stroke: var(--accent); stroke-width: 3; }
    .dim-line { stroke: var(--primary); stroke-width: 1; stroke-dasharray: 3,3; }
    .dim-text { fill: var(--primary); font-size: 10px; font-weight: 600; }
    .angle-arc { fill: none; stroke: var(--accent); stroke-width: 1.5; }
    .angle-text { fill: var(--accent); font-size: 9px; font-weight: 600; }
    .label-text { fill: var(--text-muted); font-size: 9px; }

    @media print {
      .header, .section-nav, .level-bar, .btn, .done-btn, .showme-btn { display: none !important; }
      .section-content { display: block !important; }
    }
  </style>
</head>
<body>

  <!-- HEADER -->
  <div class="header">
    <div class="header-left">
      <h1>Drawing Workshop</h1>
      <p>From Container to Countertop | T1-L08 | Year 8 Technology</p>
    </div>
    <div class="header-right">
      <input type="text" class="header-input" id="studentName" placeholder="Your name">
      <input type="text" class="header-input" id="studentClass" placeholder="Class" style="width:80px">
      <span class="header-badge">TE4-DES-01</span>
      <span class="header-badge">TE4-PPM-01</span>
    </div>
  </div>

  <!-- LEVEL BAR -->
  <div class="level-bar">
    <button class="level-btn" data-level="guided" onclick="setLevel('guided')">Guided</button>
    <button class="level-btn active" data-level="standard" onclick="setLevel('standard')">Standard</button>
    <button class="level-btn" data-level="challenge" onclick="setLevel('challenge')">Challenge</button>
  </div>

  <!-- SECTION NAVIGATION -->
  <nav class="section-nav">
    <button class="section-btn active" onclick="switchSection('iso')">
      Isometric Box
      <span class="step-count">Steps 1–6</span>
    </button>
    <button class="section-btn" onclick="switchSection('features')">
      Add Features
      <span class="step-count">Steps 7–10</span>
    </button>
    <button class="section-btn" onclick="switchSection('ortho-front')">
      Front View
      <span class="step-count">Steps 11–13</span>
    </button>
    <button class="section-btn" onclick="switchSection('ortho-side')">
      Side View
      <span class="step-count">Steps 14–16</span>
    </button>
    <button class="section-btn" onclick="switchSection('ortho-top')">
      Top (Plan) View
      <span class="step-count">Steps 17–19</span>
    </button>
    <button class="section-btn" onclick="switchSection('check')">
      Self-Check
      <span class="step-count">Review</span>
    </button>
  </nav>

  <!-- =============================================
       SECTION 1: ISOMETRIC BOX
       ============================================= -->
  <div id="section-iso" class="section-content active">
    <div class="card">
      <h2>Step-by-Step: Draw the Isometric Container Box</h2>
      <p>Follow along on your <strong>isometric dot paper</strong>. The drawing canvas below shows what you should draw at each step. Your container model is <span class="step-measure">30 cm long</span> <span class="step-measure">12 cm wide</span> <span class="step-measure">12 cm tall</span> at 1:20 scale.</p>

      <div class="progress-bar-wrap">
        <div class="progress-bar" id="isoProgress" style="width: 0%"></div>
      </div>

      <div class="workspace">
        <div class="canvas-area">
          <div class="drawing-canvas">
            <svg id="isoCanvas" viewBox="0 0 500 380">
              <!-- Grid dots (isometric) -->
              <defs>
                <pattern id="isoDots" x="0" y="0" width="20" height="34.64" patternUnits="userSpaceOnUse">
                  <circle cx="0" cy="0" r="1" fill="#d1d5db"/>
                  <circle cx="10" cy="17.32" r="1" fill="#d1d5db"/>
                  <circle cx="20" cy="0" r="1" fill="#d1d5db"/>
                  <circle cx="20" cy="34.64" r="1" fill="#d1d5db"/>
                </pattern>
              </defs>
              <rect width="500" height="380" fill="url(#isoDots)" opacity="0.5"/>

              <!-- All lines start as ghost, become solid when step is completed -->
              <!-- Step 1: Front vertical edge -->
              <line id="iso-1" x1="250" y1="300" x2="250" y2="180" stroke="#475569" stroke-width="2.5" class="ghost-line"/>
              <!-- Step 2: Length line going up-left at 30° -->
              <line id="iso-2" x1="250" y1="300" x2="100" y2="387" stroke="#475569" stroke-width="2.5" class="ghost-line" transform="rotate(0)"/>
              <!-- Corrected: going upper-left from bottom of vertical -->
              <line id="iso-2a" x1="250" y1="300" x2="70" y2="196" stroke="#475569" stroke-width="2.5" class="ghost-line"/>
              <!-- Step 3: Width line going up-right at 30° -->
              <line id="iso-3" x1="250" y1="300" x2="322" y2="258" stroke="#475569" stroke-width="2.5" class="ghost-line"/>
              <!-- Step 4a: Top-left parallel to width -->
              <line id="iso-4a" x1="250" y1="180" x2="322" y2="138" stroke="#475569" stroke-width="2.5" class="ghost-line"/>
              <!-- Step 4b: Top-right parallel to length -->
              <line id="iso-4b" x1="322" y1="258" x2="322" y2="138" stroke="#475569" stroke-width="2.5" class="ghost-line"/>
              <!-- Step 5a: Top back edge (parallel to length going left) -->
              <line id="iso-5a" x1="250" y1="180" x2="70" y2="76" stroke="#475569" stroke-width="2.5" class="ghost-line"/>
              <!-- Step 5b: Far back vertical -->
              <line id="iso-5b" x1="70" y1="196" x2="70" y2="76" stroke="#475569" stroke-width="2.5" class="ghost-line"/>
              <!-- Step 6a: Top back right edge -->
              <line id="iso-6a" x1="70" y1="76" x2="142" y2="34" stroke="#475569" stroke-width="2.5" class="ghost-line"/>
              <!-- Step 6b: Right back edge -->
              <line id="iso-6b" x1="322" y1="138" x2="142" y2="34" stroke="#475569" stroke-width="2.5" class="ghost-line"/>

              <!-- Dimension labels (shown progressively) -->
              <g id="iso-dim-1" style="display:none">
                <line x1="260" y1="300" x2="260" y2="180" class="dim-line"/>
                <text x="272" y="245" class="dim-text">12 cm</text>
                <text x="272" y="258" class="dim-text">(2.4 m)</text>
              </g>
              <g id="iso-dim-2" style="display:none">
                <text x="140" y="260" class="dim-text" transform="rotate(-30, 140, 260)">30 cm (6 m)</text>
              </g>
              <g id="iso-dim-3" style="display:none">
                <text x="295" y="288" class="dim-text" transform="rotate(30, 295, 288)">12 cm</text>
              </g>
              <!-- 30° angle indicators -->
              <g id="iso-angle-1" style="display:none">
                <path d="M 230 300 Q 228 290 238 286" class="angle-arc"/>
                <text x="220" y="286" class="angle-text">30°</text>
              </g>
              <g id="iso-angle-2" style="display:none">
                <path d="M 270 300 Q 272 290 264 286" class="angle-arc"/>
                <text x="270" y="286" class="angle-text">30°</text>
              </g>
            </svg>
          </div>
        </div>

        <div class="instruction-area" id="isoSteps">
          <!-- Steps generated by JS -->
        </div>
      </div>
    </div>

    <div class="callout warning" id="isoMistakes" style="display:none;">
      <strong>Watch out!</strong> Common mistake at this stage: Make sure your 30-degree angles aren't too steep (45°) or too shallow (15°). On isometric dot paper, follow the diagonal dots — every 2 dots across and 1 dot up gives you 30°.
    </div>
  </div>

  <!-- =============================================
       SECTION 2: ADD FEATURES
       ============================================= -->
  <div id="section-features" class="section-content">
    <div class="card">
      <h2>Add Features to Your Isometric Drawing</h2>
      <p>Now add the external features that make your container a restaurant. Each feature has <strong>scaled measurements</strong> to keep it accurate.</p>

      <div class="progress-bar-wrap">
        <div class="progress-bar" id="featProgress" style="width: 0%"></div>
      </div>

      <div class="workspace">
        <div class="canvas-area">
          <div class="drawing-canvas">
            <svg id="featCanvas" viewBox="0 0 500 380">
              <rect width="500" height="380" fill="white"/>
              <!-- Completed isometric box (solid) -->
              <line x1="250" y1="300" x2="250" y2="180" stroke="#475569" stroke-width="2"/>
              <line x1="250" y1="300" x2="70" y2="196" stroke="#475569" stroke-width="2"/>
              <line x1="250" y1="300" x2="322" y2="258" stroke="#475569" stroke-width="2"/>
              <line x1="250" y1="180" x2="322" y2="138" stroke="#475569" stroke-width="2"/>
              <line x1="322" y1="258" x2="322" y2="138" stroke="#475569" stroke-width="2"/>
              <line x1="250" y1="180" x2="70" y2="76" stroke="#475569" stroke-width="2"/>
              <line x1="70" y1="196" x2="70" y2="76" stroke="#475569" stroke-width="2"/>
              <line x1="70" y1="76" x2="142" y2="34" stroke="#475569" stroke-width="2"/>
              <line x1="322" y1="138" x2="142" y2="34" stroke="#475569" stroke-width="2"/>
              <!-- Light fill for faces -->
              <polygon points="250,300 70,196 70,76 250,180" fill="#b0bec5" opacity="0.15"/>
              <polygon points="250,300 322,258 322,138 250,180" fill="#94a3b8" opacity="0.15"/>
              <polygon points="250,180 70,76 142,34 322,138" fill="#cdd5de" opacity="0.15"/>

              <!-- Feature: Serving window on left face (ghost → solid) -->
              <polygon id="feat-window" points="155,230 115,210 115,183 155,203" fill="rgba(249,115,22,0.15)" stroke="#ea580c" stroke-width="2" class="ghost-line"/>
              <text id="feat-window-label" x="135" y="175" font-size="9" fill="#ea580c" text-anchor="middle" class="ghost-line">Serving Window</text>

              <!-- Feature: Counter shelf -->
              <line id="feat-counter" x1="155" y1="231" x2="115" y2="211" stroke="#8B5E3C" stroke-width="3" class="ghost-line"/>
              <text id="feat-counter-label" x="135" y="246" font-size="8" fill="#8B5E3C" text-anchor="middle" class="ghost-line">Counter</text>

              <!-- Feature: Door on front face -->
              <polygon id="feat-door" points="285,280 312,264 312,230 285,246" fill="rgba(59,130,246,0.15)" stroke="#2563eb" stroke-width="2" class="ghost-line"/>
              <text id="feat-door-label" x="298" y="222" font-size="9" fill="#2563eb" text-anchor="middle" class="ghost-line">Door</text>

              <!-- Feature: Awning -->
              <polygon id="feat-awning" points="170,215 100,180 95,182 165,217" fill="rgba(239,68,68,0.3)" stroke="#dc2626" stroke-width="1.5" class="ghost-line"/>
              <text id="feat-awning-label" x="130" y="170" font-size="8" fill="#dc2626" text-anchor="middle" style="display:none">Awning</text>
            </svg>
          </div>
        </div>

        <div class="instruction-area" id="featSteps">
          <!-- Steps generated by JS -->
        </div>
      </div>
    </div>
  </div>

  <!-- =============================================
       SECTION 3: FRONT VIEW (Orthographic)
       ============================================= -->
  <div id="section-ortho-front" class="section-content">
    <div class="card">
      <h2>Orthographic: Front View (Front Elevation)</h2>
      <p>Now we switch to orthographic projection. The front view shows the <strong>short end</strong> of the container — just height and width. Draw this on a fresh piece of paper with a border.</p>

      <div class="callout">
        <strong>Key connection:</strong> The front view shows the SAME face you see when you look straight at the front of your 3D container. Compare it with your isometric drawing!
      </div>

      <div class="progress-bar-wrap">
        <div class="progress-bar" id="frontProgress" style="width: 0%"></div>
      </div>

      <div class="workspace">
        <div class="canvas-area">
          <div class="drawing-canvas">
            <svg id="frontCanvas" viewBox="0 0 400 320">
              <rect width="400" height="320" fill="white"/>
              <!-- Border -->
              <rect x="20" y="20" width="360" height="260" fill="none" stroke="#d1d5db" stroke-width="1"/>
              <!-- Title block area -->
              <rect x="250" y="250" width="130" height="30" fill="none" stroke="#d1d5db" stroke-width="1"/>
              <text x="315" y="268" font-size="8" fill="#94a3b8" text-anchor="middle">Title Block</text>

              <!-- Front view rectangle (ghost → solid) -->
              <rect id="front-box" x="110" y="40" width="180" height="180" fill="none" stroke="#475569" stroke-width="2.5" class="ghost-line"/>

              <!-- Door -->
              <rect id="front-door" x="215" y="95" width="50" height="115" fill="rgba(59,130,246,0.1)" stroke="#2563eb" stroke-width="2" class="ghost-line"/>
              <text id="front-door-label" x="240" y="158" font-size="9" fill="#2563eb" text-anchor="middle" class="ghost-line">Door</text>

              <!-- Dimension lines -->
              <g id="front-dims" style="display:none">
                <!-- Width dimension -->
                <line x1="110" y1="235" x2="290" y2="235" class="dim-line"/>
                <line x1="110" y1="230" x2="110" y2="240" stroke="var(--primary)" stroke-width="1"/>
                <line x1="290" y1="230" x2="290" y2="240" stroke="var(--primary)" stroke-width="1"/>
                <text x="200" y="248" class="dim-text" text-anchor="middle">12 cm (2.4 m real)</text>
                <!-- Height dimension -->
                <line x1="305" y1="40" x2="305" y2="220" class="dim-line"/>
                <line x1="300" y1="40" x2="310" y2="40" stroke="var(--primary)" stroke-width="1"/>
                <line x1="300" y1="220" x2="310" y2="220" stroke="var(--primary)" stroke-width="1"/>
                <text x="320" y="135" class="dim-text" text-anchor="middle" transform="rotate(90,320,135)">12 cm (2.4 m real)</text>
              </g>
            </svg>
          </div>
        </div>

        <div class="instruction-area" id="frontSteps">
          <!-- Steps generated by JS -->
        </div>
      </div>
    </div>
  </div>

  <!-- =============================================
       SECTION 4: SIDE VIEW (Orthographic)
       ============================================= -->
  <div id="section-ortho-side" class="section-content">
    <div class="card">
      <h2>Orthographic: Side View (Side Elevation)</h2>
      <p>The side view shows the <strong>long side</strong> of the container. This is where customers see your serving window, counter, and signage!</p>

      <div class="callout accent">
        <strong>Connection to isometric:</strong> The left face of your isometric drawing IS this side view. The same window you drew in isometric appears here — but now as a proper rectangle with exact measurements.
      </div>

      <div class="progress-bar-wrap">
        <div class="progress-bar" id="sideProgress" style="width: 0%"></div>
      </div>

      <div class="workspace">
        <div class="canvas-area">
          <div class="drawing-canvas">
            <svg id="sideCanvas" viewBox="0 0 500 300">
              <rect width="500" height="300" fill="white"/>
              <rect x="15" y="15" width="470" height="250" fill="none" stroke="#d1d5db" stroke-width="1"/>

              <!-- Side view rectangle -->
              <rect id="side-box" x="30" y="30" width="420" height="168" fill="none" stroke="#475569" stroke-width="2.5" class="ghost-line"/>

              <!-- Serving window -->
              <rect id="side-window" x="160" y="55" width="120" height="70" fill="rgba(249,115,22,0.1)" stroke="#ea580c" stroke-width="2" class="ghost-line"/>
              <text id="side-window-label" x="220" y="95" font-size="9" fill="#ea580c" text-anchor="middle" class="ghost-line">Serving Window</text>

              <!-- Counter -->
              <line id="side-counter" x1="160" y1="126" x2="280" y2="126" stroke="#8B5E3C" stroke-width="3" class="ghost-line"/>

              <!-- Dimension lines -->
              <g id="side-dims" style="display:none">
                <line x1="30" y1="210" x2="450" y2="210" class="dim-line"/>
                <text x="240" y="225" class="dim-text" text-anchor="middle">30 cm (6 m real)</text>
                <line x1="460" y1="30" x2="460" y2="198" class="dim-line"/>
                <text x="475" y="120" class="dim-text" text-anchor="middle" transform="rotate(90,475,120)">12 cm (2.4 m)</text>
              </g>
            </svg>
          </div>
        </div>

        <div class="instruction-area" id="sideSteps">
          <!-- Steps generated by JS -->
        </div>
      </div>
    </div>
  </div>

  <!-- =============================================
       SECTION 5: TOP VIEW (Plan View)
       ============================================= -->
  <div id="section-ortho-top" class="section-content">
    <div class="card">
      <h2>Orthographic: Top View (Plan View)</h2>
      <p>The top view is what you see looking <strong>straight down from above</strong>. This is the most important view because it <strong>becomes your floor plan!</strong></p>

      <div class="callout success">
        <strong>This is the big connection!</strong> In lessons L13-14, you'll fill this exact top-view rectangle with kitchen equipment, counters, and zones. The plan view you draw today is the foundation of your floor plan. Same dimensions: <span class="step-measure">30 cm x 12 cm</span> at 1:20 scale.
      </div>

      <div class="progress-bar-wrap">
        <div class="progress-bar" id="topProgress" style="width: 0%"></div>
      </div>

      <div class="workspace">
        <div class="canvas-area">
          <div class="drawing-canvas">
            <svg id="topCanvas" viewBox="0 0 500 250">
              <rect width="500" height="250" fill="white"/>
              <rect x="15" y="10" width="470" height="220" fill="none" stroke="#d1d5db" stroke-width="1"/>

              <!-- Top view rectangle -->
              <rect id="top-box" x="40" y="25" width="420" height="160" fill="none" stroke="#475569" stroke-width="2.5" class="ghost-line"/>

              <!-- Window opening (gap in bottom wall) -->
              <line id="top-window" x1="170" y1="185" x2="290" y2="185" stroke="#ea580c" stroke-width="4" class="ghost-line"/>
              <text id="top-window-label" x="230" y="178" font-size="8" fill="#ea580c" text-anchor="middle" class="ghost-line">Serving Window Opening</text>

              <!-- Door with swing arc -->
              <line id="top-door" x1="460" y1="80" x2="460" y2="130" stroke="#2563eb" stroke-width="4" class="ghost-line"/>
              <path id="top-door-arc" d="M 460 130 Q 425 130 425 95" fill="none" stroke="#2563eb" stroke-width="1.5" stroke-dasharray="4,3" class="ghost-line"/>
              <text id="top-door-label" x="415" y="108" font-size="8" fill="#2563eb" text-anchor="middle" class="ghost-line">Door swing</text>

              <!-- Architectural symbols preview -->
              <g id="top-symbols" style="display:none">
                <!-- Simple zone labels -->
                <rect x="55" y="40" width="120" height="130" fill="rgba(239,68,68,0.08)" stroke="#ef4444" stroke-width="1" stroke-dasharray="4,4" rx="4"/>
                <text x="115" y="110" font-size="10" fill="#ef4444" text-anchor="middle" font-weight="600">Kitchen Zone</text>
                <rect x="185" y="40" width="120" height="130" fill="rgba(59,130,246,0.08)" stroke="#3b82f6" stroke-width="1" stroke-dasharray="4,4" rx="4"/>
                <text x="245" y="110" font-size="10" fill="#3b82f6" text-anchor="middle" font-weight="600">Service Zone</text>
                <rect x="315" y="40" width="120" height="130" fill="rgba(34,197,94,0.08)" stroke="#22c55e" stroke-width="1" stroke-dasharray="4,4" rx="4"/>
                <text x="375" y="110" font-size="10" fill="#22c55e" text-anchor="middle" font-weight="600">Storage Zone</text>
              </g>

              <!-- Dimensions -->
              <g id="top-dims" style="display:none">
                <line x1="40" y1="200" x2="460" y2="200" class="dim-line"/>
                <text x="250" y="215" class="dim-text" text-anchor="middle">30 cm (6 m real)</text>
                <line x1="470" y1="25" x2="470" y2="185" class="dim-line"/>
                <text x="485" y="110" class="dim-text" text-anchor="middle" transform="rotate(90,485,110)">12 cm (2.4 m)</text>
              </g>
            </svg>
          </div>
        </div>

        <div class="instruction-area" id="topSteps">
          <!-- Steps generated by JS -->
        </div>
      </div>
    </div>
  </div>

  <!-- =============================================
       SECTION 6: SELF-CHECK
       ============================================= -->
  <div id="section-check" class="section-content">
    <div class="card">
      <h2>Self-Assessment Checklist</h2>
      <p>Review your drawings and tick off each item. Be honest — this helps you identify what to improve!</p>

      <h3 class="mt-2">Isometric Drawing</h3>
      <ul class="checklist" id="checkIso">
        <li><span class="check-icon" onclick="toggleCheck(this)"></span>Lines are straight and drawn with a ruler</li>
        <li><span class="check-icon" onclick="toggleCheck(this)"></span>30-degree angles are correct (not 45° or flat)</li>
        <li><span class="check-icon" onclick="toggleCheck(this)"></span>Parallel lines are truly parallel</li>
        <li><span class="check-icon" onclick="toggleCheck(this)"></span>Proportions look correct (container is longer than it is wide/tall)</li>
        <li><span class="check-icon" onclick="toggleCheck(this)"></span>Serving window is visible on the side face</li>
        <li><span class="check-icon" onclick="toggleCheck(this)"></span>Door is visible on the end face</li>
        <li><span class="check-icon" onclick="toggleCheck(this)"></span>Features are labelled</li>
      </ul>

      <h3 class="mt-2">Orthographic Drawings</h3>
      <ul class="checklist" id="checkOrtho">
        <li><span class="check-icon" onclick="toggleCheck(this)"></span>Front view shows only height and width (12 cm x 12 cm)</li>
        <li><span class="check-icon" onclick="toggleCheck(this)"></span>Side view shows only height and length (12 cm x 30 cm)</li>
        <li><span class="check-icon" onclick="toggleCheck(this)"></span>Top view shows only length and width (30 cm x 12 cm)</li>
        <li><span class="check-icon" onclick="toggleCheck(this)"></span>All views are drawn to 1:20 scale</li>
        <li><span class="check-icon" onclick="toggleCheck(this)"></span>Dimension lines are included with measurements</li>
        <li><span class="check-icon" onclick="toggleCheck(this)"></span>Features appear in the correct views (window on side, door on front, etc.)</li>
        <li><span class="check-icon" onclick="toggleCheck(this)"></span>The top view looks like a floor plan outline</li>
      </ul>
    </div>

    <div class="card">
      <h2>Common Mistakes to Avoid</h2>
      <div class="mistakes-panel" style="background:#fff; border:2px solid var(--border);">
        <div class="mistake-row">
          <div class="mistake-example bad">
            <svg viewBox="0 0 120 100" width="120">
              <line x1="60" y1="80" x2="60" y2="30" stroke="#475569" stroke-width="2"/>
              <line x1="60" y1="80" x2="20" y2="40" stroke="#ef4444" stroke-width="2"/>
              <text x="30" y="50" font-size="8" fill="#ef4444">45°</text>
            </svg>
            <p style="color:#991b1b;">Too steep (45°)</p>
          </div>
          <div class="mistake-example good">
            <svg viewBox="0 0 120 100" width="120">
              <line x1="60" y1="80" x2="60" y2="30" stroke="#475569" stroke-width="2"/>
              <line x1="60" y1="80" x2="10" y2="55" stroke="#22c55e" stroke-width="2"/>
              <text x="25" y="60" font-size="8" fill="#22c55e">30°</text>
            </svg>
            <p style="color:#166534;">Correct (30°)</p>
          </div>
          <div class="mistake-example bad">
            <svg viewBox="0 0 120 100" width="120">
              <line x1="60" y1="80" x2="60" y2="30" stroke="#475569" stroke-width="2"/>
              <line x1="60" y1="80" x2="10" y2="70" stroke="#ef4444" stroke-width="2"/>
              <text x="20" y="65" font-size="8" fill="#ef4444">15°</text>
            </svg>
            <p style="color:#991b1b;">Too shallow (15°)</p>
          </div>
        </div>
        <div class="mistake-row">
          <div class="mistake-example bad">
            <svg viewBox="0 0 140 80" width="140">
              <rect x="10" y="10" width="60" height="50" fill="none" stroke="#ef4444" stroke-width="2"/>
              <rect x="80" y="10" width="50" height="50" fill="none" stroke="#ef4444" stroke-width="2"/>
              <text x="70" y="72" font-size="7" fill="#ef4444" text-anchor="middle">Different widths!</text>
            </svg>
            <p style="color:#991b1b;">Views don't match</p>
          </div>
          <div class="mistake-example good">
            <svg viewBox="0 0 140 80" width="140">
              <rect x="10" y="10" width="50" height="50" fill="none" stroke="#22c55e" stroke-width="2"/>
              <rect x="70" y="10" width="50" height="50" fill="none" stroke="#22c55e" stroke-width="2"/>
              <line x1="10" y1="5" x2="10" y2="65" stroke="#22c55e" stroke-width="0.5" stroke-dasharray="3"/>
              <line x1="60" y1="5" x2="120" y2="5" stroke="#22c55e" stroke-width="0.5" stroke-dasharray="3"/>
              <text x="70" y="72" font-size="7" fill="#22c55e" text-anchor="middle">Aligned correctly</text>
            </svg>
            <p style="color:#166534;">Views aligned</p>
          </div>
        </div>
      </div>
    </div>

    <div class="card">
      <h2>Your Project Toolkit</h2>
      <p>Here's what you've learned and what's coming next:</p>
      <div class="toolkit">
        <div class="toolkit-item done">
          <span class="toolkit-icon">&#x2705;</span>
          <span><strong>Scale (L06)</strong> — Convert real to model size</span>
        </div>
        <div class="toolkit-item done">
          <span class="toolkit-icon">&#x2705;</span>
          <span><strong>Isometric (today)</strong> — Draw a 3D view</span>
        </div>
        <div class="toolkit-item done">
          <span class="toolkit-icon">&#x2705;</span>
          <span><strong>Orthographic (today)</strong> — Draw front, side, top views</span>
        </div>
        <div class="toolkit-item current">
          <span class="toolkit-icon">&#x25B6;&#xFE0F;</span>
          <span><strong>Plan View = Floor Plan</strong> — The top view IS your floor plan!</span>
        </div>
        <div class="toolkit-item upcoming">
          <span class="toolkit-icon">&#x25CB;</span>
          <span><strong>Floor Plan (L13-14)</strong> — Fill the plan view with equipment</span>
        </div>
        <div class="toolkit-item upcoming">
          <span class="toolkit-icon">&#x25CB;</span>
          <span><strong>Model (L15-16)</strong> — Build what you've drawn!</span>
        </div>
      </div>
    </div>

    <!-- Save -->
    <div class="save-area">
      <h3>Save Your Progress</h3>
      <p>Click below to generate a link you can paste into Google Classroom.</p>
      <button class="btn btn-success" onclick="saveWork()">Save &amp; Get Link</button>
      <textarea class="save-link" id="saveLink" readonly></textarea>
    </div>
  </div>

  <!-- =============================================
       JAVASCRIPT
       ============================================= -->
  <script>
    // ==========================================
    // STATE
    // ==========================================
    let currentLevel = 'standard';
    let sectionProgress = {
      iso: 0, features: 0, 'ortho-front': 0, 'ortho-side': 0, 'ortho-top': 0
    };

    // ==========================================
    // STEP DEFINITIONS
    // ==========================================
    const steps = {
      iso: [
        {
          title: 'Draw the front vertical edge',
          body: '<p>Start with a <strong>vertical line</strong> in the centre of your paper. This is the front corner of your container.</p><p class="step-measure">Height: 12 cm (ruler-length on isometric paper)</p><p>This line represents the 2.4 m height of the real container at 1:20 scale.</p>',
          elements: ['iso-1'],
          dims: ['iso-dim-1'],
          showme: 'Draw a straight line going straight UP from your starting point.'
        },
        {
          title: 'Draw the length line at 30° (going upper-left)',
          body: '<p>From the <strong>bottom</strong> of your vertical line, draw a line going <strong>upper-left at 30 degrees</strong>.</p><p class="step-measure">Length: 30 cm along this axis (6 m real)</p><p>On isometric dot paper, follow the dots diagonally — 2 dots across for every 1 dot up.</p>',
          elements: ['iso-2a'],
          dims: ['iso-dim-2', 'iso-angle-1'],
          showme: 'From the bottom of your vertical line, go upper-left following the 30° grid dots.'
        },
        {
          title: 'Draw the width line at 30° (going upper-right)',
          body: '<p>From the <strong>same bottom point</strong>, draw a line going <strong>upper-right at 30 degrees</strong>.</p><p class="step-measure">Width: 12 cm along this axis (2.4 m real)</p><p>Now you should have a "Y" shape — the vertical line and two 30° lines.</p>',
          elements: ['iso-3'],
          dims: ['iso-dim-3', 'iso-angle-2'],
          showme: 'From the same starting point, go upper-right following the 30° grid dots.'
        },
        {
          title: 'Complete the right face (front end)',
          body: '<p>From the <strong>top of the vertical line</strong>, draw a line <strong>parallel</strong> to the width line (upper-right at 30°). Then draw a vertical line down from the end of the width line.</p><p>You should now see the <strong>front face</strong> of your container (a parallelogram).</p>',
          elements: ['iso-4a', 'iso-4b'],
          dims: [],
          showme: 'Draw two more lines to close the front face into a parallelogram.'
        },
        {
          title: 'Draw the back edges (top and left side)',
          body: '<p>From the <strong>top of the vertical line</strong>, draw a line <strong>parallel</strong> to the length line (upper-left at 30°). Then draw a <strong>vertical line</strong> up from the end of the length line.</p><p>The left face (serving side) is now visible!</p>',
          elements: ['iso-5a', 'iso-5b'],
          dims: [],
          showme: 'Draw two more lines to form the left (serving) side of the container.'
        },
        {
          title: 'Complete the top face',
          body: '<p>Connect the remaining open corners to complete the <strong>top face</strong> of the container.</p><p>&#127881; <strong>Congratulations!</strong> You\'ve drawn the basic isometric container box! It should look like a 3D rectangular box viewed from the corner.</p>',
          elements: ['iso-6a', 'iso-6b'],
          dims: [],
          showme: 'Close the top face by connecting the two remaining open corners.'
        }
      ],
      features: [
        {
          title: 'Draw the serving window',
          body: '<p>On the <strong>left face</strong> (the long serving side), draw a <strong>rectangle</strong> for the serving window.</p><p class="step-measure">Window: approx 5 cm wide x 3 cm tall on drawing</p><p>Position it about one-third from the left, in the upper half of the face. Remember: on the isometric face, the rectangle is a parallelogram!</p>',
          elements: ['feat-window', 'feat-window-label'],
          dims: [],
          showme: 'Draw a parallelogram on the left face, matching the 30° angle of the face edges.'
        },
        {
          title: 'Add the fold-down counter',
          body: '<p>Below the serving window, draw a <strong>horizontal line</strong> (following the 30° angle) for the fold-down counter shelf.</p><p class="step-measure">Same width as the window</p><p>This is where customers rest their food while paying.</p>',
          elements: ['feat-counter', 'feat-counter-label'],
          dims: [],
          showme: 'Draw a thick line below the window, parallel to the face edges.'
        },
        {
          title: 'Draw the entry door',
          body: '<p>On the <strong>right face</strong> (the short front end), draw a <strong>rectangle</strong> for the staff entry door.</p><p class="step-measure">Door: approx 2.5 cm wide x 5 cm tall on drawing</p><p>Position it near the right side of the front face, touching the bottom edge.</p>',
          elements: ['feat-door', 'feat-door-label'],
          dims: [],
          showme: 'Draw a parallelogram on the front face for the door. It should touch the bottom edge.'
        },
        {
          title: 'Add the awning',
          body: '<p>Above the serving window, draw a <strong>narrow strip</strong> extending outward slightly. This represents the fold-out awning that provides shade for customers.</p><p>The awning follows the same 30° angle as the left face.</p>',
          elements: ['feat-awning', 'feat-awning-label'],
          dims: [],
          showme: 'Draw a narrow parallelogram above the window area, slightly protruding from the face.'
        }
      ],
      'ortho-front': [
        {
          title: 'Draw the front view rectangle',
          body: '<p>Draw a <strong>rectangle</strong> for the front face of the container. Since it\'s the short end, it\'s nearly square.</p><p class="step-measure">Width: 12 cm | Height: 12 cm</p><p>Use your ruler carefully — accuracy matters in orthographic drawing!</p>',
          elements: ['front-box'],
          dims: [],
          showme: 'Draw a 12cm x 12cm rectangle. Use your ruler for straight lines.'
        },
        {
          title: 'Add the entry door',
          body: '<p>Draw the entry door on the right side of the front view.</p><p class="step-measure">Door: approx 2.5 cm wide x 5 cm tall</p><p>The door should touch the bottom edge. Label it clearly.</p>',
          elements: ['front-door', 'front-door-label'],
          dims: [],
          showme: 'Draw a rectangle on the right side for the door.'
        },
        {
          title: 'Add dimension lines',
          body: '<p>Add <strong>dimension lines</strong> with arrows showing the width and height measurements. Include both the model measurement AND the real measurement.</p><p>Dimension lines go <strong>outside</strong> the drawing, with extension lines connecting to the edges.</p>',
          elements: [],
          dims: ['front-dims'],
          showme: 'Draw thin lines with arrows outside the rectangle showing measurements.'
        }
      ],
      'ortho-side': [
        {
          title: 'Draw the side view rectangle',
          body: '<p>Draw a <strong>rectangle</strong> for the long side of the container. This is much wider than the front view!</p><p class="step-measure">Width: 30 cm | Height: 12 cm</p><p><strong>Important:</strong> The HEIGHT must match the front view exactly (12 cm). This is how orthographic views stay consistent.</p>',
          elements: ['side-box'],
          dims: [],
          showme: 'Draw a 30cm x 12cm rectangle. The height must match your front view.'
        },
        {
          title: 'Add the serving window and counter',
          body: '<p>Draw the serving window as a <strong>proper rectangle</strong> (not a parallelogram like in isometric).</p><p class="step-measure">Window: approx 6 cm wide x 3.5 cm tall</p><p>Add the counter shelf as a line below the window. This is the view customers see!</p>',
          elements: ['side-window', 'side-window-label', 'side-counter'],
          dims: [],
          showme: 'Draw a rectangle in the upper-centre of the side view. Add a line below for the counter.'
        },
        {
          title: 'Add dimension lines',
          body: '<p>Add dimension lines showing the total width (30 cm / 6 m) and height (12 cm / 2.4 m). Also dimension the window if you have space.</p>',
          elements: [],
          dims: ['side-dims'],
          showme: 'Add measurement lines outside the rectangle.'
        }
      ],
      'ortho-top': [
        {
          title: 'Draw the plan view rectangle',
          body: '<p>Draw the <strong>top-down view</strong> rectangle. Looking straight down, you see the full length and width.</p><p class="step-measure">Width: 30 cm | Height: 12 cm</p><p><strong>Critical:</strong> This rectangle is the EXACT same size and shape as your future floor plan! The dimensions must be accurate.</p>',
          elements: ['top-box'],
          dims: ['top-dims'],
          showme: 'Draw a 30cm x 12cm rectangle. This will become your floor plan outline!'
        },
        {
          title: 'Mark the window and door openings',
          body: '<p>In the top view, the window and door appear as <strong>openings in the walls</strong> (gaps or thicker lines on the edges).</p><p>The serving window opening goes on the <strong>long side (bottom edge)</strong>. The door goes on the <strong>short side (right edge)</strong>.</p><p>Draw a <strong>door swing arc</strong> — a quarter-circle showing which way the door opens inward.</p>',
          elements: ['top-window', 'top-window-label', 'top-door', 'top-door-arc', 'top-door-label'],
          dims: [],
          showme: 'Mark openings on the wall edges. The door gets a quarter-circle arc showing its swing direction.'
        },
        {
          title: 'Preview: Design zones',
          body: '<p>In later lessons, you\'ll divide this floor plan into <strong>three zones</strong>:</p><ul style="margin-left:1.2rem;font-size:0.9rem;"><li><strong style="color:#ef4444;">Kitchen Zone</strong> — cooking equipment, prep area</li><li><strong style="color:#3b82f6;">Service Zone</strong> — serving window, counter, register</li><li><strong style="color:#22c55e;">Storage Zone</strong> — fridge, shelves, cleaning</li></ul><p class="mt-1">Click "I\'ve drawn this" to see a preview of the zones on your plan!</p>',
          elements: [],
          dims: ['top-symbols'],
          showme: 'This is a preview — you\'ll add zones in a future lesson.'
        }
      ]
    };

    // ==========================================
    // LEVEL SELECTOR
    // ==========================================
    function setLevel(level) {
      currentLevel = level;
      document.querySelectorAll('.level-btn').forEach(b => b.classList.remove('active'));
      document.querySelector(`.level-btn[data-level="${level}"]`).classList.add('active');
      document.body.className = level === 'guided' ? 'guided' : '';
      // In challenge mode, reveal all steps at once
      if (level === 'challenge') {
        document.querySelectorAll('.step-card.locked').forEach(card => {
          card.classList.remove('locked');
        });
      }
    }

    // ==========================================
    // SECTION SWITCHING
    // ==========================================
    function switchSection(sectionId) {
      document.querySelectorAll('.section-content').forEach(s => s.classList.remove('active'));
      document.querySelectorAll('.section-btn').forEach(b => b.classList.remove('active'));
      document.getElementById('section-' + sectionId).classList.add('active');
      // Find matching nav button
      const sections = ['iso', 'features', 'ortho-front', 'ortho-side', 'ortho-top', 'check'];
      const idx = sections.indexOf(sectionId);
      if (idx >= 0) document.querySelectorAll('.section-btn')[idx].classList.add('active');
    }

    // ==========================================
    // STEP RENDERING
    // ==========================================
    function renderSteps(sectionId) {
      const stepsArr = steps[sectionId];
      if (!stepsArr) return;
      const container = document.getElementById(sectionId + 'Steps') ||
                       document.getElementById(sectionId.replace('ortho-', '') + 'Steps');
      // Try to find the correct container
      const containerId = {
        'iso': 'isoSteps',
        'features': 'featSteps',
        'ortho-front': 'frontSteps',
        'ortho-side': 'sideSteps',
        'ortho-top': 'topSteps'
      }[sectionId];
      const el = document.getElementById(containerId);
      if (!el) return;

      const progress = sectionProgress[sectionId] || 0;

      el.innerHTML = stepsArr.map((step, i) => {
        let cls = 'step-card';
        if (i < progress) cls += ' completed';
        else if (i === progress) cls += ' current';
        else if (currentLevel !== 'challenge') cls += ' locked';

        return `
          <div class="${cls}" data-section="${sectionId}" data-step="${i}">
            <div class="step-header">
              <div class="step-num">${i < progress ? '&#x2713;' : (i + 1)}</div>
              <div class="step-title">${step.title}</div>
            </div>
            <div class="step-body">
              ${step.body}
              ${currentLevel === 'guided' && step.showme ? `<button class="showme-btn" onclick="showMe('${sectionId}', ${i})">Show me how</button>` : ''}
              <button class="done-btn" onclick="completeStep('${sectionId}', ${i})">&#x2713; I've drawn this</button>
            </div>
          </div>
        `;
      }).join('');

      updateCanvas(sectionId, progress);
      updateProgressBar(sectionId, progress, stepsArr.length);
    }

    function completeStep(sectionId, stepIndex) {
      const stepsArr = steps[sectionId];
      if (stepIndex !== sectionProgress[sectionId]) return;

      sectionProgress[sectionId] = stepIndex + 1;

      // Make elements solid
      const step = stepsArr[stepIndex];
      step.elements.forEach(id => {
        const el = document.getElementById(id);
        if (el) {
          el.classList.remove('ghost-line');
          el.classList.add('solid-line');
        }
      });
      step.dims.forEach(id => {
        const el = document.getElementById(id);
        if (el) el.style.display = 'block';
      });

      // Show mistakes warning after step 3 of isometric
      if (sectionId === 'iso' && stepIndex === 2) {
        const m = document.getElementById('isoMistakes');
        if (m) m.style.display = 'block';
      }

      // Re-render steps
      renderSteps(sectionId);

      // If section completed, mark nav button
      if (sectionProgress[sectionId] >= stepsArr.length) {
        const sections = ['iso', 'features', 'ortho-front', 'ortho-side', 'ortho-top', 'check'];
        const idx = sections.indexOf(sectionId);
        const navBtns = document.querySelectorAll('.section-btn');
        if (idx >= 0 && navBtns[idx]) {
          navBtns[idx].classList.add('completed');
        }
      }
    }

    function updateCanvas(sectionId, progress) {
      const stepsArr = steps[sectionId];
      if (!stepsArr) return;

      // Make completed steps solid, current step highlighted ghost, future steps hidden ghost
      stepsArr.forEach((step, i) => {
        step.elements.forEach(id => {
          const el = document.getElementById(id);
          if (!el) return;
          if (i < progress) {
            el.classList.remove('ghost-line');
            el.classList.add('solid-line');
            el.style.display = '';
          } else if (i === progress) {
            el.classList.add('ghost-line');
            el.classList.remove('solid-line');
            el.style.display = '';
            el.style.opacity = '0.5';
            el.style.strokeDasharray = '8,5';
          } else {
            el.style.display = 'none';
          }
        });
        step.dims.forEach(id => {
          const el = document.getElementById(id);
          if (!el) return;
          el.style.display = i < progress ? 'block' : 'none';
        });
      });
    }

    function updateProgressBar(sectionId, progress, total) {
      const barId = {
        'iso': 'isoProgress',
        'features': 'featProgress',
        'ortho-front': 'frontProgress',
        'ortho-side': 'sideProgress',
        'ortho-top': 'topProgress'
      }[sectionId];
      const bar = document.getElementById(barId);
      if (bar) {
        bar.style.width = Math.round((progress / total) * 100) + '%';
      }
    }

    function showMe(sectionId, stepIndex) {
      const step = steps[sectionId][stepIndex];
      if (!step) return;
      // Flash the ghost elements to highlight them
      step.elements.forEach(id => {
        const el = document.getElementById(id);
        if (el) {
          el.style.transition = 'all 0.5s';
          el.style.opacity = '1';
          el.style.stroke = '#f97316';
          el.style.strokeWidth = '4';
          setTimeout(() => {
            el.style.opacity = '0.5';
            el.style.stroke = '';
            el.style.strokeWidth = '';
          }, 1500);
        }
      });
      // Show the showme text
      alert(step.showme);
    }

    // ==========================================
    // SELF-CHECK TOGGLE
    // ==========================================
    function toggleCheck(el) {
      el.classList.toggle('checked');
      el.innerHTML = el.classList.contains('checked') ? '&#x2713;' : '';
    }

    // ==========================================
    // SAVE
    // ==========================================
    function saveWork() {
      const data = {
        name: document.getElementById('studentName').value,
        class: document.getElementById('studentClass').value,
        level: currentLevel,
        progress: sectionProgress,
        checklist: getChecklistState(),
        timestamp: new Date().toISOString()
      };
      const encoded = btoa(unescape(encodeURIComponent(JSON.stringify(data))));
      const link = window.location.href.split('?')[0] + '?data=' + encoded;
      const linkEl = document.getElementById('saveLink');
      linkEl.value = link;
      linkEl.classList.add('show');
      linkEl.select();
      try { navigator.clipboard.writeText(link); } catch(e) {}
    }

    function getChecklistState() {
      const checks = {};
      document.querySelectorAll('.checklist li').forEach((li, i) => {
        checks[i] = li.querySelector('.check-icon').classList.contains('checked');
      });
      return checks;
    }

    // ==========================================
    // INIT
    // ==========================================
    function init() {
      // Render all step sections
      Object.keys(steps).forEach(sectionId => {
        renderSteps(sectionId);
      });

      // Load from URL if present
      const params = new URLSearchParams(window.location.search);
      const data = params.get('data');
      if (data) {
        try {
          const parsed = JSON.parse(decodeURIComponent(escape(atob(data))));
          if (parsed.name) document.getElementById('studentName').value = parsed.name;
          if (parsed.class) document.getElementById('studentClass').value = parsed.class;
          if (parsed.level) setLevel(parsed.level);
          if (parsed.progress) {
            sectionProgress = parsed.progress;
            Object.keys(steps).forEach(sectionId => renderSteps(sectionId));
          }
        } catch(e) {}
      }
    }

    init();
  </script>
</body>
</html>
